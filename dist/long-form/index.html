<!DOCTYPE html><html lang="en"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><meta name="generator" content="Astro v5.5.2"><title>Long-form Book Writer - Goriber Lekhok</title><link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/_astro/chapter.BGrLNQQD.css">
<link rel="stylesheet" href="/_astro/chapter.CdmOkNDU.css">
<style>.spinner[data-astro-cid-q7dtpkqc]{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#09f;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.hidden[data-astro-cid-q7dtpkqc]{display:none}
</style></head> <body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-gray-100 font-['Space_Grotesk']"> <div class="min-h-screen flex relative overflow-hidden"> <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_-20%,#3b82f6,transparent_70%)] opacity-20"></div> <aside class="w-64 glass border-r border-gray-700/50 z-10"> <div class="p-6"> <h1 class="t1 g">Goriber Lekhok</h1> </div> <nav class="mt-6 px-3"> <a href="/" class="n">Dashboard</a> <a href="/long-form" class="n">Long-form Book Writer</a> <a href="/ebook" class="n">E-book Writer</a> <a href="/guide" class="n">Writing Guider</a> <a href="/creator" class="n">E-Book Creator</a> <a href="/chapter" class="n">Chapter Creator</a> <a href="/offers" class="n">Gifts and Offers</a> <a href="/tickets" class="n">Support Tickets</a> <a href="/contact" class="n">Contact</a> </nav> </aside> <main class="flex-1 p-8 relative">  <!-- Form layout --><div class="c d relative" data-astro-cid-q7dtpkqc> <h2 class="t1 g mb-8" data-astro-cid-q7dtpkqc>Create Long-form Book</h2> <form id="bookForm" class="f" data-astro-cid-q7dtpkqc> <div data-astro-cid-q7dtpkqc> <label class="l" data-astro-cid-q7dtpkqc>Book Title</label> <input type="text" name="title" class="i" required data-astro-cid-q7dtpkqc> </div> <div data-astro-cid-q7dtpkqc> <label class="l" data-astro-cid-q7dtpkqc>Book Description</label> <textarea name="description" class="i h-32" required data-astro-cid-q7dtpkqc></textarea> </div> <div data-astro-cid-q7dtpkqc> <label class="l" data-astro-cid-q7dtpkqc>Number of Chapters</label> <select name="chapters" class="i" data-astro-cid-q7dtpkqc> <option value="1" data-astro-cid-q7dtpkqc>1</option><option value="2" data-astro-cid-q7dtpkqc>2</option><option value="3" data-astro-cid-q7dtpkqc>3</option><option value="4" data-astro-cid-q7dtpkqc>4</option><option value="5" data-astro-cid-q7dtpkqc>5</option><option value="6" data-astro-cid-q7dtpkqc>6</option><option value="7" data-astro-cid-q7dtpkqc>7</option><option value="8" data-astro-cid-q7dtpkqc>8</option><option value="9" data-astro-cid-q7dtpkqc>9</option><option value="10" data-astro-cid-q7dtpkqc>10</option><option value="11" data-astro-cid-q7dtpkqc>11</option><option value="12" data-astro-cid-q7dtpkqc>12</option><option value="13" data-astro-cid-q7dtpkqc>13</option><option value="14" data-astro-cid-q7dtpkqc>14</option><option value="15" data-astro-cid-q7dtpkqc>15</option><option value="16" data-astro-cid-q7dtpkqc>16</option><option value="17" data-astro-cid-q7dtpkqc>17</option><option value="18" data-astro-cid-q7dtpkqc>18</option><option value="19" data-astro-cid-q7dtpkqc>19</option><option value="20" data-astro-cid-q7dtpkqc>20</option><option value="21" data-astro-cid-q7dtpkqc>21</option><option value="22" data-astro-cid-q7dtpkqc>22</option><option value="23" data-astro-cid-q7dtpkqc>23</option><option value="24" data-astro-cid-q7dtpkqc>24</option><option value="25" data-astro-cid-q7dtpkqc>25</option><option value="26" data-astro-cid-q7dtpkqc>26</option><option value="27" data-astro-cid-q7dtpkqc>27</option><option value="28" data-astro-cid-q7dtpkqc>28</option><option value="29" data-astro-cid-q7dtpkqc>29</option><option value="30" data-astro-cid-q7dtpkqc>30</option> </select> </div> <button type="submit" class="b" data-astro-cid-q7dtpkqc>Create Book</button> </form> </div> <!-- Modal overlay for loading --> <div id="loadingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50" data-astro-cid-q7dtpkqc> <div class="bg-gray-800 rounded p-6 text-gray-100 max-w-sm w-full" data-astro-cid-q7dtpkqc> <p class="mb-4" data-astro-cid-q7dtpkqc>Creating book, please wait...</p> <div class="spinner mx-auto" data-astro-cid-q7dtpkqc></div> </div> </div> <!-- Simple spinner styles (optional) -->  <script type="module">
// 1) Import Marked from a CDN for client-side Markdown parsing.
import { marked } from 'https://cdn.jsdelivr.net/npm/marked@4.3.0/lib/marked.esm.js';

// Elements
const form = document.getElementById('bookForm');
const loadingModal = document.getElementById('loadingModal');

// Helper to extract a main title if the text starts with "# ...",
// and to transform lines beginning with "Chapter" into "## Chapter"
// so Marked will parse them as headings.
function preprocessMarkdown(markdown) {
  const lines = markdown.split('\n');
  let mainTitle = null;
  let mainTitleIndex = -1;

  for (let i = 0; i < lines.length; i++) {
    const trimmed = lines[i].trim();
    // Find first "# " line
    if (!mainTitle && trimmed.startsWith('# ')) {
      mainTitle = trimmed.replace(/^# /, '').trim();
      mainTitleIndex = i;
      break;
    }
  }

  // Remove the main title line from the text
  if (mainTitleIndex !== -1) {
    lines.splice(mainTitleIndex, 1);
  }

  // Convert lines starting with "Chapter" into "## Chapter" headings
  // so that Marked will parse them as <h2>.
  const processedLines = lines.map((line) => {
    const trimmed = line.trimStart();
    if (trimmed.startsWith('Chapter')) {
      // Insert "## " before "Chapter"
      return `## ${line}`;
    }
    return line;
  });

  return { mainTitle, body: processedLines.join('\n') };
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();

  // Show modal overlay
  loadingModal.classList.remove('hidden');
  
  const formData = new FormData(form);
  const payload = {
    title: formData.get('title'),
    description: formData.get('description'),
    chapters: parseInt(formData.get('chapters'), 10)
  };

  try {
    const res = await fetch('http://localhost:5000/generate-book', { 
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    
    const data = await res.json();
    
    // Hide modal
    loadingModal.classList.add('hidden');

    if (data.error) {
      // Replace the body content with an error message
      document.body.innerHTML = `
        <div class="p-8 max-w-3xl mx-auto">
          <div class="flex justify-between items-center mb-4">
            <button
              onclick="location.href='/'"
              class="px-4 py-2 bg-blue-500 text-white rounded"
            >
              Back
            </button>
            <h1 class="text-2xl font-bold">Error</h1>
          </div>
          <p class="text-red-400">Error: ${data.error}</p>
        </div>
      `;
    } else {
      // Preprocess the text to find the main title and convert "Chapter" lines
      let { mainTitle, body } = preprocessMarkdown(data.book);
      // If none found, fallback to user's input
      const finalTitle = mainTitle || payload.title;
      
      // Convert to HTML
      const htmlContent = marked.parse(body);

      // Overwrite the entire body with just the book content
      document.body.innerHTML = `
        <div class="p-8 max-w-3xl mx-auto">
          <div class="flex justify-between items-center mb-8">
            <button
              onclick="location.href='/'"
              class="px-4 py-2 bg-blue-500 text-white rounded"
            >
              Back
            </button>
            <h1 class="text-2xl font-bold">${finalTitle}</h1>
          </div>
          <article class="prose prose-invert prose-lg max-w-none leading-relaxed space-y-4">
            ${htmlContent}
          </article>
        </div>
      `;
    }
  } catch (err) {
    // Hide modal if fetch fails
    loadingModal.classList.add('hidden');

    document.body.innerHTML = `
      <div class="p-8 max-w-3xl mx-auto">
        <div class="flex justify-between items-center mb-4">
          <button
            onclick="location.href='/'"
            class="px-4 py-2 bg-blue-500 text-white rounded"
          >
            Back
          </button>
          <h1 class="text-2xl font-bold">Error</h1>
        </div>
        <p class="text-red-400">Error: ${err.message}</p>
      </div>
    `;
  }
});
</script>  </main> </div> </body></html>